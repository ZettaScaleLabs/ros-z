<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Code Generation Internals - ros-z Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Native Rust ROS 2 implementation using Zenoh">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../mdbook-admonish.css">
        <link rel="stylesheet" href="../book/mdbook-admonish.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ros-z Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ZettaScaleLabs/ros-z" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ZettaScaleLabs/ros-z/edit/main/src/chapters/python_codegen.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="python-code-generation-internals"><a class="header" href="#python-code-generation-internals">Python Code Generation Internals</a></h1>
<p>This chapter explains how ros-z generates Python bindings for ROS 2 messages, including the architecture, generated code structure, and design rationale.</p>
<h2 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h2>
<p>ros-z uses a <strong>hybrid approach</strong>: Python classes for ergonomics, Rust for serialization performance. The architecture uses <strong>derive macros</strong> for automatic Python-Rust conversion of arbitrarily nested message types.</p>
<pre class="mermaid">graph TB
    subgraph &quot;Build Time (cargo build)&quot;
        ROS[&quot;.msg/.srv files&quot;] --&gt; Parser[&quot;ros-z-codegen&lt;br/&gt;Parser&quot;]
        Parser --&gt; Resolver[&quot;Dependency&lt;br/&gt;Resolver&quot;]
        Resolver --&gt; PyGen[&quot;Python Generator&quot;]
        Resolver --&gt; RsGen[&quot;Rust Generator&quot;]
        PyGen --&gt; PyFiles[&quot;*.py files&lt;br/&gt;(msgspec structs)&quot;]
        RsGen --&gt; RsFile[&quot;Rust structs with&lt;br/&gt;derive macros&quot;]
        RsGen --&gt; PyO3File[&quot;python_bindings.rs&lt;br/&gt;(serialize/deserialize)&quot;]
    end

    subgraph &quot;Derive Macros (ros-z-derive)&quot;
        Derive[&quot;FromPyMessage&lt;br/&gt;IntoPyMessage&quot;]
        Derive --&gt;|&quot;generates&quot;| Extract[&quot;Field extraction code&quot;]
        Derive --&gt;|&quot;generates&quot;| Construct[&quot;Object construction code&quot;]
    end

    subgraph &quot;Runtime&quot;
        PyFiles --&gt; PyObj[&quot;Python Object&quot;]
        PyObj --&gt;|&quot;FromPyMessage::from_py()&quot;| RsStruct[&quot;Rust Struct&quot;]
        RsStruct --&gt;|&quot;ros-z-cdr::to_vec()&quot;| CDR[&quot;CDR Bytes&quot;]
        CDR --&gt;|&quot;Zenoh&quot;| Network[&quot;Network&quot;]
    end
</pre>
<h3 id="key-components"><a class="header" href="#key-components">Key Components</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Component</th><th>Location</th><th>Purpose</th></tr></thead><tbody>
<tr><td><strong>Python Generator</strong></td><td><code>ros-z-codegen/src/generator/python.rs</code></td><td>Generates msgspec struct classes</td></tr>
<tr><td><strong>Rust Generator</strong></td><td><code>ros-z-codegen/src/generator/rust.rs</code></td><td>Generates Rust structs with derive attributes</td></tr>
<tr><td><strong>PyO3 Generator</strong></td><td><code>ros-z-codegen/src/python_msgspec_generator.rs</code></td><td>Generates serialize/deserialize wrapper functions</td></tr>
<tr><td><strong>Derive Macros</strong></td><td><code>ros-z-derive/src/lib.rs</code></td><td><code>FromPyMessage</code> and <code>IntoPyMessage</code> derive macros</td></tr>
<tr><td><strong>Bridge Traits</strong></td><td><code>ros-z/src/python_bridge.rs</code></td><td>Core traits for Python-Rust conversion</td></tr>
<tr><td><strong>Build Script</strong></td><td><code>ros-z-msgs/build.rs</code></td><td>Orchestrates code generation at build time</td></tr>
<tr><td><strong>Generated Python</strong></td><td><code>ros-z-msgs/python/ros_z_msgs_py/types/*.py</code></td><td>One file per ROS package</td></tr>
<tr><td><strong>Generated Rust</strong></td><td><code>$OUT_DIR/python_bindings.rs</code></td><td>Compiled into <code>ros-z-msgs</code> crate</td></tr>
</tbody></table>
</div>
<h2 id="generated-code-examples"><a class="header" href="#generated-code-examples">Generated Code Examples</a></h2>
<h3 id="python-msgspec-structs"><a class="header" href="#python-msgspec-structs">Python: msgspec Structs</a></h3>
<p>For each ROS message, a frozen <code>msgspec.Struct</code> is generated:</p>
<pre><code class="language-python"># Generated from std_msgs/msg/String.msg
class String(msgspec.Struct, frozen=True, kw_only=True):
    data: str = ""

    __msgtype__: ClassVar[str] = 'std_msgs/msg/String'
    __hash__: ClassVar[str] = 'RIHS01_df668c740482bbd48fb39d76a70dfd4bd59db1288021743503259e948f6b1a18'
</code></pre>
<p>Nested messages use forward references:</p>
<pre><code class="language-python"># Generated from geometry_msgs/msg/Twist.msg
class Twist(msgspec.Struct, frozen=True, kw_only=True):
    linear: "geometry_msgs.Vector3 | None" = None
    angular: "geometry_msgs.Vector3 | None" = None

    __msgtype__: ClassVar[str] = 'geometry_msgs/msg/Twist'
    __hash__: ClassVar[str] = 'RIHS01_9c45bf16fe0983d80e3cfe750d6835843d265a9a6c46bd2e609fcddde6fb8d2a'
</code></pre>
<p>Service request/response types use the service type hash in <code>__hash__</code>:</p>
<pre><code class="language-python"># Generated from example_interfaces/srv/AddTwoInts.srv
class AddTwoIntsRequest(msgspec.Struct, frozen=True, kw_only=True):
    a: int = 0
    b: int = 0

    __msgtype__: ClassVar[str] = 'example_interfaces/msg/AddTwoIntsRequest'
    __hash__: ClassVar[str] = 'RIHS01_e118de6bf5eeb66a2491b5bda11202e7b68f198d6f67922cf30364858239c81a'

class AddTwoIntsResponse(msgspec.Struct, frozen=True, kw_only=True):
    sum: int = 0

    __msgtype__: ClassVar[str] = 'example_interfaces/msg/AddTwoIntsResponse'
    __hash__: ClassVar[str] = 'RIHS01_e118de6bf5eeb66a2491b5bda11202e7b68f198d6f67922cf30364858239c81a'
</code></pre>
<p>For service types, <code>__hash__</code> contains the service type hash (computed from the combined request/response definition). Both request and response share the same hash since they belong to the same service. This differs from regular messages where <code>__hash__</code> contains the individual message type hash.</p>
<h3 id="rust-generated-structs-with-derive-macros"><a class="header" href="#rust-generated-structs-with-derive-macros">Rust: Generated Structs with Derive Macros</a></h3>
<p>The Rust code generator adds derive attributes to message structs:</p>
<pre><code class="language-rust ignore">// Generated from std_msgs/msg/String.msg
#[derive(Debug, Clone, Default, ::serde::Serialize, ::serde::Deserialize)]
#[cfg_attr(feature = "python_registry", derive(::ros_z_derive::FromPyMessage, ::ros_z_derive::IntoPyMessage))]
#[cfg_attr(feature = "python_registry", ros_msg(module = "ros_z_msgs_py.types.std_msgs"))]
pub struct String {
    pub data: std::string::String,
}</code></pre>
<p>For nested messages with optional fields:</p>
<pre><code class="language-rust ignore">// Generated from geometry_msgs/msg/Twist.msg
#[derive(Debug, Clone, Default, ::serde::Serialize, ::serde::Deserialize)]
#[cfg_attr(feature = "python_registry", derive(::ros_z_derive::FromPyMessage, ::ros_z_derive::IntoPyMessage))]
#[cfg_attr(feature = "python_registry", ros_msg(module = "ros_z_msgs_py.types.geometry_msgs"))]
pub struct Twist {
    pub linear: Vector3,
    pub angular: Vector3,
}</code></pre>
<h3 id="derive-macros-zero-copy-byte-array-handling"><a class="header" href="#derive-macros-zero-copy-byte-array-handling">Derive Macros: Zero-Copy Byte Array Handling</a></h3>
<p>Fields annotated with <code>#[ros_msg(zbuf)]</code> (applied automatically by the code generator for <code>uint8[]</code>/<code>byte[]</code> fields) get special treatment in the derive macros:</p>
<p><strong><code>FromPyMessage</code></strong> (Python → Rust) tries three paths in order:</p>
<ol>
<li><strong>ZBufView</strong> — extracts the inner <code>ZBuf</code> via <code>clone()</code> (reference-counted, zero-copy)</li>
<li><strong><code>bytes</code>/<code>bytearray</code></strong> — copies into a new <code>ZBuf</code></li>
<li><strong><code>list[int]</code></strong> — fallback extraction</li>
</ol>
<pre><code class="language-rust ignore">// Generated by FromPyMessage derive macro for #[ros_msg(zbuf)] fields
let py_attr = obj.getattr("data")?;
if let Ok(view) = py_attr.downcast::&lt;ZBufView&gt;() {
    view.borrow().zbuf().clone()     // Arc clone — no data copy
} else if let Ok(bytes) = py_attr.downcast::&lt;PyBytes&gt;() {
    ZBuf::from(bytes.as_bytes().to_vec())
} else if let Ok(bytearray) = py_attr.downcast::&lt;PyByteArray&gt;() {
    ZBuf::from(unsafe { bytearray.as_bytes() }.to_vec())
} else {
    let bytes: Vec&lt;u8&gt; = py_attr.extract()?;
    ZBuf::from(bytes)
}</code></pre>
<p><strong><code>IntoPyMessage</code></strong> (Rust → Python) creates a <code>ZBufView</code> instead of copying into <code>PyBytes</code>:</p>
<pre><code class="language-rust ignore">// Generated by IntoPyMessage derive macro for #[ros_msg(zbuf)] fields
let zbuf_view = ZBufView::new(self.data.clone());
let py_view = Py::new(py, zbuf_view)?;
kwargs.set_item("data", py_view)?;</code></pre>
<p>This means a received message's byte array fields can be passed directly to a new message for re-publishing without any data copy.</p>
<h3 id="rust-pyo3-serializedeserialize-functions"><a class="header" href="#rust-pyo3-serializedeserialize-functions">Rust: PyO3 Serialize/Deserialize Functions</a></h3>
<p>The serialize/deserialize functions use the derive macro traits:</p>
<pre><code class="language-rust ignore">// Generated serialize function - uses FromPyMessage trait
#[pyfunction]
pub fn serialize_string(py: Python, msg: &amp;Bound&lt;'_, PyAny&gt;) -&gt; PyResult&lt;Vec&lt;u8&gt;&gt; {
    use ::pyo3::types::PyAnyMethods;
    use ::ros_z::python_bridge::FromPyMessage;

    // Derive macro handles all field extraction recursively
    let rust_msg = &lt;ros::std_msgs::String&gt;::from_py(msg)?;

    // CDR serialization with 4-byte encapsulation header
    let mut cdr_data = ros_z_cdr::to_vec::&lt;_, ros_z_cdr::LittleEndian&gt;(&amp;rust_msg, 256)
        .map_err(|e| pyo3::exceptions::PyValueError::new_err(e.to_string()))?;
    let mut result = vec![0x00, 0x01, 0x00, 0x00]; // CDR encapsulation header
    result.append(&amp;mut cdr_data);
    Ok(result)
}

// Generated deserialize function - uses IntoPyMessage trait
#[pyfunction]
pub fn deserialize_string(py: Python, bytes: &amp;[u8]) -&gt; PyResult&lt;PyObject&gt; {
    use ::ros_z::python_bridge::IntoPyMessage;

    // Skip 4-byte CDR encapsulation header
    let cdr_data = &amp;bytes[4..];
    let (rust_msg, _): (ros::std_msgs::String, _) = ros_z_cdr::from_bytes::&lt;_, ros_z_cdr::LittleEndian&gt;(cdr_data)
        .map_err(|e| pyo3::exceptions::PyValueError::new_err(e.to_string()))?;

    // Derive macro handles all field construction recursively
    rust_msg.into_py_message(py)
}</code></pre>
<h2 id="data-flow"><a class="header" href="#data-flow">Data Flow</a></h2>
<h3 id="publishing-python-to-wire"><a class="header" href="#publishing-python-to-wire">Publishing (Python to Wire)</a></h3>
<pre class="mermaid">sequenceDiagram
    participant App as Python App
    participant Msg as msgspec.Struct
    participant PyO3 as PyO3 Layer
    participant Rust as Rust Struct
    participant CDR as CDR Encoder
    participant Net as Zenoh Network

    App-&gt;&gt;Msg: Create message
    App-&gt;&gt;PyO3: publish(msg)
    PyO3-&gt;&gt;PyO3: getattr() each field
    PyO3-&gt;&gt;Rust: Construct Rust struct
    Rust-&gt;&gt;CDR: cdr::serialize()
    CDR-&gt;&gt;Net: Send bytes
</pre>
<h3 id="subscribing-wire-to-python"><a class="header" href="#subscribing-wire-to-python">Subscribing (Wire to Python)</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Net as Zenoh Network
    participant CDR as CDR Decoder
    participant Rust as Rust Struct
    participant PyO3 as PyO3 Layer
    participant Msg as msgspec.Struct
    participant App as Python App

    Net-&gt;&gt;CDR: Receive bytes
    Note over CDR: Store ZBuf in thread-local&lt;br/&gt;for zero-copy deser
    CDR-&gt;&gt;Rust: cdr::deserialize()
    Note over CDR,Rust: byte[] fields → ZSlice sub-view&lt;br/&gt;(zero-copy)
    Rust-&gt;&gt;PyO3: Build PyDict kwargs
    Note over PyO3: byte[] → ZBufView&lt;br/&gt;(buffer protocol)
    PyO3-&gt;&gt;Msg: Call class(**kwargs)
    Msg-&gt;&gt;App: Return message
</pre>
<h2 id="type-mapping"><a class="header" href="#type-mapping">Type Mapping</a></h2>
<h3 id="ros-to-python-type-mapping"><a class="header" href="#ros-to-python-type-mapping">ROS to Python Type Mapping</a></h3>
<div class="table-wrapper"><table><thead><tr><th>ROS Type</th><th>Python Type</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>bool</code></td><td><code>bool</code></td><td></td></tr>
<tr><td><code>byte</code>, <code>uint8</code>, <code>int8</code>, <code>int16</code>, <code>uint16</code>, <code>int32</code>, <code>uint32</code>, <code>int64</code>, <code>uint64</code></td><td><code>int</code></td><td>Python has arbitrary precision</td></tr>
<tr><td><code>float32</code>, <code>float64</code></td><td><code>float</code></td><td></td></tr>
<tr><td><code>string</code></td><td><code>str</code></td><td></td></tr>
<tr><td><code>T[]</code> (unbounded array)</td><td><code>list[T]</code></td><td></td></tr>
<tr><td><code>T[N]</code> (fixed array)</td><td><code>list[T]</code></td><td>Size not enforced in Python</td></tr>
<tr><td><code>uint8[]</code> / <code>byte[]</code></td><td><code>ZBufView</code></td><td>Zero-copy buffer protocol (on receive); accepts <code>bytes</code>, <code>bytearray</code>, or <code>ZBufView</code> on publish</td></tr>
<tr><td>Nested message</td><td><code>"pkg.MsgName | None"</code></td><td>Forward reference string</td></tr>
</tbody></table>
</div>
<h2 id="design-hybrid-python--rust-with-derive-macros"><a class="header" href="#design-hybrid-python--rust-with-derive-macros">Design: Hybrid Python + Rust with Derive Macros</a></h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────┐
│                    Current Architecture                      │
├─────────────────────────────────────────────────────────────┤
│  Python Layer          │  Rust Layer (via PyO3)             │
│  ─────────────         │  ──────────────────────            │
│  • msgspec structs     │  • Derive macros                   │
│  • Type annotations    │  • Trait-based conversion          │
│  • IDE support         │  • CDR serialization               │
│  • User-facing API     │  • Zenoh transport                 │
│                        │  • Memory management               │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>Features:</strong></p>
<ul>
<li>Fast serialization (Rust CDR implementation)</li>
<li>Type-safe Python classes with IDE support</li>
<li>Immutable messages (<code>frozen=True</code>)</li>
<li>Automatic type hash validation</li>
<li>Zero-copy byte array handling: <code>ZBufView</code> exposes received data via buffer protocol without copying; <code>FromPyMessage</code> detects <code>ZBufView</code> inputs and extracts the inner buffer via reference counting</li>
<li><strong>Derive macros handle arbitrary nesting depth automatically</strong></li>
<li><strong>None handling for optional nested fields</strong></li>
<li><strong>Minimal generated code (traits do the work)</strong></li>
</ul>
<h2 id="build-process"><a class="header" href="#build-process">Build Process</a></h2>
<h3 id="step-by-step-flow"><a class="header" href="#step-by-step-flow">Step-by-step Flow</a></h3>
<pre class="mermaid">flowchart TD
    A[&quot;cargo build ros-z-msgs&lt;br/&gt;--features python_registry&quot;] --&gt; B[&quot;build.rs executes&quot;]
    B --&gt; C[&quot;Discover ROS packages&lt;br/&gt;(AMENT_PREFIX_PATH or bundled)&quot;]
    C --&gt; D[&quot;Parse .msg/.srv files&quot;]
    D --&gt; E[&quot;Resolve dependencies&lt;br/&gt;(type hashes, nested types)&quot;]
    E --&gt; F[&quot;Generate Python files&quot;]
    E --&gt; G[&quot;Generate Rust PyO3 module&quot;]
    F --&gt; H[&quot;ros-z-msgs/python/&lt;br/&gt;ros_z_msgs_py/types/*.py&quot;]
    G --&gt; I[&quot;$OUT_DIR/python_bindings.rs&quot;]
    I --&gt; J[&quot;include!() in lib.rs&quot;]
    J --&gt; K[&quot;Compiled into ros-z-msgs&quot;]
</pre>
<h3 id="output-locations"><a class="header" href="#output-locations">Output Locations</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Output</th><th>Path</th><th>Committed?</th></tr></thead><tbody>
<tr><td>Python msgspec classes</td><td><code>ros-z-msgs/python/ros_z_msgs_py/types/*.py</code></td><td>Yes</td></tr>
<tr><td>Rust PyO3 bindings</td><td><code>target/.../ros-z-msgs-.../out/python_bindings.rs</code></td><td>No (generated)</td></tr>
</tbody></table>
</div>
<h3 id="feature-flags"><a class="header" href="#feature-flags">Feature Flags</a></h3>
<p>The Python codegen is gated behind the <code>python_registry</code> feature:</p>
<pre><code class="language-rust ignore">// lib.rs
#[cfg(feature = "python_registry")]
include!(concat!(env!("OUT_DIR"), "/python_bindings.rs"));</code></pre>
<p>The <code>ros-z-derive</code> crate provides the derive macros, and <code>ros-z/python</code> enables the <code>FromPyMessage</code> and <code>IntoPyMessage</code> traits.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapters/python.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../chapters/nix.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapters/python.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../chapters/nix.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
